<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Build Operation - CMSIS-Toolbox</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Build Operation";
        var mkdocs_page_input_path = "build-operation.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CMSIS-Toolbox
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../build-tools/">Build Tools</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../build-overview/">CSolution Project Structure</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../YML-Input-Format/">CSolution Project Format</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CreateApplications/">Create Applications</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ReferenceApplications/">Reference Applications</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CubeMX/">Configure STM32 Devices with STM32CubeMX</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../MCUXpressoConfig/">Configure NXP Devices with MCUXpresso Config Tools</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../YML-CBuild-Format/">Build Information Files</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Build Operation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#build-process-overview">Build Process Overview</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cbuild-build-invocation">cbuild Build Invocation</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#details-of-the-build-mode">Details of the build mode</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#details-of-the-setup-mode">Details of the setup mode</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#csolution-project-manager">csolution Project Manager</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cbuild2cmake-generate-cmakelists-files">cbuild2cmake Generate CMakeLists Files</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cmake-invocation">CMake Invocation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#adding-a-toolchain-to-cmsis-toolbox">Adding a Toolchain to CMSIS-Toolbox</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#steps">Steps</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cmake-variables">CMake Variables</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#branchprot-values">BRANCHPROT Values</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cmake-integration">CMake Integration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#example">Example</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#generator-integration">Generator Integration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#generator-start-via-component">Generator Start via component</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#global-generator-registry-file">Global Generator Registry File</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../pack-tools/">Pack Creation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Troubleshooting/">Troubleshooting</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Experimental-Features/">Experimental Features</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CMSIS-Toolbox</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Build Operation</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/Open-CMSIS-Pack/cmsis-toolbox/edit/main/docs/build-operation.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="build-operation">Build Operation</h1>
<!-- markdownlint-disable MD009 -->
<!-- markdownlint-disable MD013 -->
<!-- markdownlint-disable MD036 -->

<p>This chapter explains the overall build process of the CMSIS-Toolbox and how to add a new compiler toolchain.</p>
<h2 id="build-process-overview">Build Process Overview</h2>
<p>This section contains details of the build process. For a high-level description, refer to <a href="../overview/#overall-workflow">Overall Workflow</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>The tool options <code>--verbose</code> and <code>--debug</code> enable detailed output about the build process for analysis.</li>
<li>Refer to the chapter <a href="../build-tools/">Build Tools</a> for more information on the command line syntax.</li>
</ul>
</div>
<h3 id="cbuild-build-invocation"><code>cbuild</code> Build Invocation</h3>
<p>The <code>cbuild</code> utility controls the overall build process. It has two operating modes:</p>
<ul>
<li><strong>build mode</strong> generates the application and is the default command (no explicit command required).</li>
<li><strong>setup mode</strong> generates the setup information for an IDE to populate dialogues, IntelliSense, and project outline views.</li>
</ul>
<h4 id="details-of-the-build-mode">Details of the build mode</h4>
<p>Without a specific <code>cbuild</code> command, the application is built. The typical invocation is:</p>
<pre><code class="language-bash">cbuild &lt;name&gt;.csolution.yml [--packs] [--context-set] [--update-rte] [--frozen-packs]
</code></pre>
<p>It generates the application program that is described with the <code>&lt;name&gt;.csolution.yml</code> project.</p>
<ul>
<li>When option <code>--packs</code> is used, it downloads missing <em>software packs</em> using <a href="../build-tools/#cpackget-invocation"><code>cpackget</code></a>.</li>
<li>It calls <a href="../build-tools/#csolution-invocation"><code>csolution</code></a> to process the the <code>&lt;name&gt;.csolution.yml</code> project.<ul>
<li>With option <code>--update-rte</code> new configuration files from <em>software packs</em> are updated and the <a href="../build-overview/#rte_componentsh"><code>RTE_Components.h</code></a> file is recreated.</li>
<li>With option <code>--context-set</code> the file <code>*.cbuild-set.yml</code> specifies the <a href="../build-overview/#context">context</a> configuration of the application.</li>
<li>With option <code>--frozen-packs</code> the file <code>*.cbuild-pack.yml</code> is used as input to issue an error when a pack version changes.</li>
</ul>
</li>
<li>The output are <a href="../YML-CBuild-Format/">build information files</a> with all relevant project information for the build process.</li>
<li>The option <code>--toolchain</code> can be used to explicitly select a compiler.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, the <code>cbuild</code> invocation does not update or change configuration files in the <a href="../build-overview/#rte-directory-structure"><strong>RTE Directory</strong></a>. Use the option <code>--update-rte</code> if this is required.</p>
</div>
<h4 id="details-of-the-setup-mode">Details of the setup mode</h4>
<p>The <code>cbuild setup</code> command prepares the data for an IDE environment. This command is called at the start of an IDE or whenever a <em>csolution project</em> file is modified. The typical invocation is:</p>
<pre><code class="language-bash">cbuild setup &lt;name&gt;.csolution.yml [--packs] [--context-set] [--update-rte] [--frozen-packs]
</code></pre>
<p>Typical IDE environments use a <code>--context-set</code> that specifies the <a href="../build-overview/#context">context</a> configuration of the application. For an application described by a <code>&lt;name&gt;.csolution.yml</code> file, these steps are executed:</p>
<ul>
<li>Check YML file syntax against schema for all files specified by <code>&lt;name&gt;.csolution.yml</code>.</li>
<li>Check the correctness of all files specified by <code>&lt;name&gt;.csolution.yml</code>.</li>
<li>Evaluate the potential <a href="../YML-CBuild-Format/#configurations">software layers</a> for <a href="../ReferenceApplications/">Reference Applications</a> using <code>variables:</code> to refer to layers (if the value is undefined). All projects are considered in this step.</li>
<li>Evaluate the <a href="../YML-CBuild-Format/#select-compiler">selectable compiler toolchains</a> when the <em>csolution project</em> does not contain a <code>compiler:</code> selection or the <code>--toolchain</code> option is not applied. The available toolchains are based on the <a href="../installation/#compiler-registration">compiler registration</a> and the <code>select-compiler:</code> node in the file <a href="../YML-Input-Format/#solution"><code>&lt;name&gt;.csolution.yml</code></a> or <a href="../YML-Input-Format/#cdefault"><code>cdefault.yml</code></a>.</li>
<li>Create the file <code>compile_commands.json</code> in the <a href="../build-overview/#output-directory-structure">output directory</a> for the context defined in <a href="../YML-CBuild-Format/"><code>*.cbuild-set.yml</code></a>.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The file <code>compile_commands.json</code> is generated by <code>CMake</code> with the option <code>--target &lt;context&gt;-database</code> and contains all source files of the <code>context</code> along with compiler options. It is used by the <a href="https://code.visualstudio.com/docs/editor/intellisense">IntelliSense</a> system of an IDE.</p>
</div>
<p>The operation is further controlled by options: </p>
<ul>
<li>The option <code>--packs</code> downloads missing software packs.</li>
<li>The option <code>--context-set</code> restricts the operation to the <a href="../build-overview/#working-with-context-set"><code>context-set</code></a> selected by the file <a href="../YML-CBuild-Format/"><code>&lt;name&gt;.cbuild-set.yml</code></a>. If this file is missing a file <code>&lt;name&gt;.cbuild-set.yml</code> with a selection of the first <code>target-type</code>, the first <code>build-type</code>, and the first <code>project</code> that is specified in the file <code>&lt;name&gt;.csolution.yml</code> is created. </li>
<li>The option <a href="../build-overview/#rte-directory-structure"><code>--update-rte</code></a> updates the configuration files of the application.</li>
<li>With the option <code>--frozen-packs</code> the file <code>*.cbuild-pack.yml</code> is used as input. An error is issued when a pack version changes.</li>
<li>The option <code>--toolchain</code> can be used to explicitly select a compiler.</li>
</ul>
<h3 id="csolution-project-manager"><code>csolution</code> Project Manager</h3>
<p><a href="../build-overview/"><code>csolution</code></a> processes the <a href="../YML-Input-Format/"><em>csolution project files</em> (in YAML format)</a> and the <code>*.pdsc</code> metadata files of <em>software packs</em> and performs the following operations:</p>
<ul>
<li>In the <a href="../build-overview/#project-area"><strong>Project Area</strong></a>:<ul>
<li>Generate <a href="../YML-CBuild-Format/">build information files</a> <code>*.cbuild-idx.yml</code> and <code>*.cbuild.yml</code> with all relevant project information for the build process.</li>
</ul>
</li>
<li>In the <a href="../build-overview/#rte-directory-structure"><strong>RTE Directory</strong></a>:<ul>
<li>Generate for each <a href="../YML-Input-Format/#context">context</a> the <a href="../build-overview/#rte_componentsh">RTE_components.h</a> file and pre-include files from the software pack (<code>*.pdsc</code>)  metadata.</li>
<li><a href="../build-overview/#plm-of-configuration-files">Copy the configuration files</a> from selected software componentsand provide <a href="../build-overview/#plm-of-configuration-files">PLM</a> information.</li>
</ul>
</li>
<li>In the <a href="../build-overview/#project-area"><strong>base directory of the solution</strong></a>:<ul>
<li>Generate the file <code>*.cbuild-pack.yml</code> that records all used <em>software packs</em>. With the option <code>--frozen-packs</code>, this file is used as input.</li>
<li>With the option <code>--context-set</code> the file <code>*.cbuild-set.yml</code> specifies the <a href="../build-overview/#context">context</a> configuration of the application. When <code>--context</code> names are specified this file is updated with this selection.</li>
</ul>
</li>
</ul>
<p>The picture below outlines the operation.</p>
<p><img alt="Operation of csolution tool" src="../images/csolution-operation.png" title="Operation of csolution tool" /></p>
<h3 id="cbuild2cmake-generate-cmakelists-files"><code>cbuild2cmake</code> Generate CMakeLists Files</h3>
<p><code>cbuild2cmake</code> reads the <a href="../YML-CBuild-Format/">build information files</a> <code>*.cbuild-idx.yml</code> and <code>*.cbuild.yml</code> to get all relevant project information for the build process. It generates the following output files for <code>CMake</code> build system:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Output Directory/File</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>./&lt;tmp-dir&gt;/CMakeList.txt</code></td>
<td style="text-align: left;">Describes the overall application build process with the current <a href="../build-overview/#context">context</a> configuration.</td>
</tr>
<tr>
<td style="text-align: left;"><code>./&lt;tmp-dir&gt;/&lt;context&gt;</code></td>
<td style="text-align: left;">Each context has a separate sub-directory with the following files:</td>
</tr>
<tr>
<td style="text-align: left;"><code>./&lt;tmp-dir&gt;/&lt;context&gt;/CMakeList.txt</code></td>
<td style="text-align: left;">Describes the build process for this context.</td>
</tr>
<tr>
<td style="text-align: left;"><code>./&lt;tmp-dir&gt;/&lt;context&gt;/toolchain.cmake</code></td>
<td style="text-align: left;">Describes the toolchain used for this context.</td>
</tr>
<tr>
<td style="text-align: left;"><code>./&lt;tmp-dir&gt;/&lt;context&gt;/groups.cmake</code></td>
<td style="text-align: left;">Contains all definitions and source files that are related to file <a href="../YML-Input-Format/#groups">groups</a>.</td>
</tr>
<tr>
<td style="text-align: left;"><code>./&lt;tmp-dir&gt;/&lt;context&gt;/components.cmake</code></td>
<td style="text-align: left;">Contains all definitions and source files that are related to <a href="../YML-Input-Format/#components">components</a>.</td>
</tr>
</tbody>
</table>
<h3 id="cmake-invocation"><code>CMake</code> Invocation</h3>
<p>The CMake build system is invoked with the following commands:</p>
<ul>
<li>CMake configuration command defines the build generator, source, and build directory with:</li>
</ul>
<p><code>cmake -G Ninja -S &lt;tmpdir&gt; -B &lt;tmpdir&gt; -Wnodev</code></p>
<ul>
<li>CMake build command to build the application program for each <a href="../build-overview/#context">context</a> with:</li>
</ul>
<p><code>cmake --build &lt;tmpdir&gt; -j &lt;n&gt; --target &lt;context&gt;</code></p>
<ul>
<li>CMake build command to generate the IntelliSense <code>compile_commands.json</code> (used by the command <code>cbuild setup</code>) for each <a href="../build-overview/#context">context</a> with:</li>
</ul>
<p><code>cmake --build &lt;tmpdir&gt; -j &lt;n&gt; --target &lt;context&gt;-database</code></p>
<h2 id="adding-a-toolchain-to-cmsis-toolbox">Adding a Toolchain to CMSIS-Toolbox</h2>
<p>The following section explains how to add a compiler toolchain to the CMSIS-Toolbox.</p>
<h3 id="steps">Steps</h3>
<p>The section below describes the steps to add a new compiler toolchain to the CMSIS-Toolbox. </p>
<ol>
<li>Define a <code>compiler_name</code> for the new compiler toolchain, i.e. <code>CLang</code>.</li>
<li>Add this <code>compiler_name</code> to the <code>"CompilerType":</code> in the schema file <a href="https://github.com/Open-CMSIS-Pack/devtools/blob/main/tools/projmgr/schemas/common.schema.json"><code>./tools/projmgr/schemas/common.schema.json</code></a>.</li>
<li>Create a new CMake file in <a href="https://github.com/Open-CMSIS-Pack/devtools/tree/main/tools/buildmgr/cbuildgen/config"><code>./tools/buildmgr/cbuildgen/config</code></a> with the naming convention <code>compiler_name.&lt;version&gt;.cmake</code>.</li>
<li>Map with the file <code>compiler_name.&lt;version&gt;.cmake</code>. the <strong>CMake</strong> input variables to the <strong>CMake</strong> toolchain variables.</li>
<li>Use an existing <code>*.cmake</code> file, i.e. <code>GCC.&lt;version&gt;.cmake</code> as a reference.</li>
</ol>
<h3 id="cmake-variables">CMake Variables</h3>
<p>The <code>CMakeLists.txt</code> file sets the following <strong>CMake</strong> input variables that should be processed by <code>compiler_name.&lt;version&gt;.cmake</code>.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">CMake Variable</th>
<th style="text-align: left;">Possible Values</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>BYTE_ORDER</code></td>
<td style="text-align: left;">Little-endian, Big-endian</td>
<td style="text-align: left;"><a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/pdsc_family_pg.html#Dendian">Endian processor configuration</a></td>
</tr>
<tr>
<td style="text-align: left;"><code>CPU</code></td>
<td style="text-align: left;"><a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/pdsc_family_pg.html#DcoreEnum">DCoreEnum</a></td>
<td style="text-align: left;">Processor core selection</td>
</tr>
<tr>
<td style="text-align: left;"><code>FPU</code></td>
<td style="text-align: left;"><a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/pdsc_family_pg.html#DfpuEnum">DfpuEnum</a></td>
<td style="text-align: left;">Floating point unit support</td>
</tr>
<tr>
<td style="text-align: left;"><code>DSP</code></td>
<td style="text-align: left;"><a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/pdsc_family_pg.html#DdspEnum">DdspEnum</a></td>
<td style="text-align: left;">DSP instruction set support</td>
</tr>
<tr>
<td style="text-align: left;"><code>TZ</code></td>
<td style="text-align: left;"><a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/pdsc_family_pg.html#DtzEnum">DtzEnum</a></td>
<td style="text-align: left;">TrustZone support</td>
</tr>
<tr>
<td style="text-align: left;"><code>SECURE</code></td>
<td style="text-align: left;"><a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/pdsc_family_pg.html#DsecureEnum">DsecureEnum</a></td>
<td style="text-align: left;">Software model selection</td>
</tr>
<tr>
<td style="text-align: left;"><code>MVE</code></td>
<td style="text-align: left;"><a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/pdsc_family_pg.html#DmveEnum">DmveEnum</a></td>
<td style="text-align: left;">MVE instruction set support</td>
</tr>
<tr>
<td style="text-align: left;"><code>BRANCHPROT</code></td>
<td style="text-align: left;"><a href="#branchprot-values"><code>BRANCHPROT</code> values</a></td>
<td style="text-align: left;">[Branch protection</td>
</tr>
<tr>
<td style="text-align: left;"><code>OPTIMIZE</code></td>
<td style="text-align: left;"><a href="../YML-Input-Format/#optimize">Optimize values</a></td>
<td style="text-align: left;">Generic optimize levels for code generation</td>
</tr>
<tr>
<td style="text-align: left;"><code>WARNINGS</code></td>
<td style="text-align: left;"><a href="../YML-Input-Format/#warnings">Warnings values</a></td>
<td style="text-align: left;">Control warning level for compiler diagnostic</td>
</tr>
<tr>
<td style="text-align: left;"><code>DEBUG</code></td>
<td style="text-align: left;"><a href="../YML-Input-Format/#debug">Debug values</a></td>
<td style="text-align: left;">Control the generation of debug information</td>
</tr>
<tr>
<td style="text-align: left;"><code>DEFINES</code></td>
<td style="text-align: left;"><a href="../YML-Input-Format/#define">Define symbols</a></td>
<td style="text-align: left;">List of symbol #define statements</td>
</tr>
</tbody>
</table>
<h4 id="branchprot-values"><code>BRANCHPROT</code> Values</h4>
<p>The following table lists the possible values for the CMake variable <code>BRANCHPROT</code>.</p>
<table>
<thead>
<tr>
<th>Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>NO_BRANCHPROT</td>
<td>Branch protection not used</td>
</tr>
<tr>
<td>BTI</td>
<td>Using BTI (Branch Target ID)</td>
</tr>
<tr>
<td>BTI_SIGNRET</td>
<td>Using BTI + Sign Return</td>
</tr>
</tbody>
</table>
<p>The <code>compiler_name.&lt;version&gt;.cmake</code> sets the following <strong>CMake</strong> variables to specify the toolchain and select toolchain options.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">CMake Variable</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>ASM_CPU</code>, <code>CC_CPU</code>, <code>CXX_CPU</code></td>
<td style="text-align: left;">Device selection set according to the combination of device attributes (<code>CPU</code>, <code>FPU</code>, <code>DSP</code>, <code>MVE</code>, etc.)</td>
</tr>
<tr>
<td style="text-align: left;"><code>AS_LEG_CPU</code>, <code>AS_ARM_CPU</code>, <code>AS_GNU_CPU</code></td>
<td style="text-align: left;">Similar to the previous item but for assembly dialect variants (if applicable)</td>
</tr>
<tr>
<td style="text-align: left;"><code>ASM_FLAGS</code>, <code>CC_FLAGS</code>, <code>CXX_FLAGS</code>, <code>LD_FLAGS</code></td>
<td style="text-align: left;">Flags applicable to all modules of the given language</td>
</tr>
<tr>
<td style="text-align: left;"><code>CC_SECURE</code>, <code>LD_SECURE</code></td>
<td style="text-align: left;">Flags applicable only for secure projects</td>
</tr>
<tr>
<td style="text-align: left;"><code>_PI</code></td>
<td style="text-align: left;">Pre-include option</td>
</tr>
<tr>
<td style="text-align: left;"><code>_ISYS</code></td>
<td style="text-align: left;">system include option</td>
</tr>
<tr>
<td style="text-align: left;"><code>LIB_PREFIX</code></td>
<td style="text-align: left;">Generated library name prefix</td>
</tr>
<tr>
<td style="text-align: left;"><code>LIB_SUFFIX</code></td>
<td style="text-align: left;">Generated library name suffix</td>
</tr>
<tr>
<td style="text-align: left;"><code>EXE_SUFFIX</code></td>
<td style="text-align: left;">Generated executable name suffix</td>
</tr>
<tr>
<td style="text-align: left;"><code>ELF2HEX</code></td>
<td style="text-align: left;">Flags for ELF to HEX conversion</td>
</tr>
<tr>
<td style="text-align: left;"><code>ELF2BIN</code></td>
<td style="text-align: left;">Flags for ELF to BIN conversion</td>
</tr>
<tr>
<td style="text-align: left;"><code>CMAKE_C_COMPILER_ID</code></td>
<td style="text-align: left;">CMake compiler identifier</td>
</tr>
<tr>
<td style="text-align: left;"><code>CMAKE_C_COMPILER_VERSION</code></td>
<td style="text-align: left;">CMake compiler version</td>
</tr>
</tbody>
</table>
<h2 id="cmake-integration">CMake Integration</h2>
<p>The <a href="../YML-Input-Format/#executes"><code>executes:</code></a> node in the <em>csolution project</em> files allows the integration of other CMake projects or scripts.</p>
<h3 id="example">Example</h3>
<p>The following <code>CMakeLists.txt</code> file integrates the <a href="https://arm-software.github.io/MDK-Middleware/latest/Network/group__nw__sw__util__fcarm.html">FCARM file converter</a> that is part of the MDK-Middleware. The FCARM file converter reformats all web files into a single C-file which is then included and compiled into the project. </p>
<pre><code class="language-cmake"># CMakeLists.txt for calling FCARM
# Find input files in the input base directory and in its subfolders using recursive scanning
# Format arguments and generate a steering command file, overcoming any command line length limitation
# Call FCARM using the steering command file, generating the source file in the expected output  
#
# Configuration Step: ${CMAKE_COMMAND} -G &lt;generator&gt; -S &lt;source directory&gt; -B &lt;build directory&gt; -DINPUT_DIRECTORY=&lt;input base directory&gt; -DOUTPUT=&lt;output source file&gt;
# Build Step: ${CMAKE_COMMAND} --build &lt;build directory&gt;
#
# &lt;generator&gt;: underlying generator build system, e.g. Ninja
# &lt;source directory&gt;: directory where this CMakeLists.txt resides
# &lt;build directory&gt;: directory for temp files
# &lt;input base directory&gt;: directory where input data is located
# &lt;output source file&gt;: path and filename of source file to be generated

cmake_minimum_required(VERSION 3.22)
include(ExternalProject)

project(&quot;FCARM&quot; NONE)

file(GLOB_RECURSE INPUT ${INPUT_DIRECTORY}/*)

foreach(ITEM ${INPUT})
  cmake_path(RELATIVE_PATH ITEM BASE_DIRECTORY ${INPUT_DIRECTORY} OUTPUT_VARIABLE FILE)
  list(APPEND FILES ${FILE})
endforeach()
string(REPLACE &quot;;&quot; &quot;,\n&quot; FILES &quot;${FILES}&quot;)

cmake_path(RELATIVE_PATH OUTPUT BASE_DIRECTORY ${INPUT_DIRECTORY} OUTPUT_VARIABLE RELATIVE_OUTPUT)
cmake_path(GET INPUT_DIRECTORY FILENAME INPUT_DIRECTORY_NAME)
cmake_path(GET INPUT_DIRECTORY PARENT_PATH WORKING_DIRECTORY)

set(COMMAND_FILE &quot;${CMAKE_CURRENT_BINARY_DIR}/Auto_FcArm_Cmd.inp&quot;)
file(WRITE ${COMMAND_FILE} &quot;${FILES}\nTO ${RELATIVE_OUTPUT} RTE NOPRINT ROOT(${INPUT_DIRECTORY_NAME})\n&quot;)

add_custom_target(FCARM ALL DEPENDS ${OUTPUT})
add_custom_command(OUTPUT ${OUTPUT} DEPENDS ${INPUT}
  COMMAND fcarm @${COMMAND_FILE} 
  WORKING_DIRECTORY ${WORKING_DIRECTORY}
)
</code></pre>
<p>Integration in a <em>csolution project</em>. In this case, it is part of the <code>*.csolution.yml</code>, but it may also be part of the <code>*.cproject.yml</code> file that uses the source file <code>Web.c</code> as input. The CMake build system checks for project dependencies and schedules the overall build process.</p>
<pre><code class="language-yml">solution:
  :

  executes:
    - execute: Run-FCARM
      run: ${CMAKE_COMMAND} -G Ninja -S ${INPUT_0} -B ${CMAKE_CURRENT_BINARY_DIR}/fcarm-cmake -DINPUT_DIRECTORY=${INPUT_1} -DOUTPUT=${OUTPUT} &amp;&amp; ${CMAKE_COMMAND} --build ${CMAKE_CURRENT_BINARY_DIR}/fcarm-cmake -- --quiet
      always:
      input:
        - fcarm-cmake    # CMake script directory
        - Web            # Input directory with &quot;web files&quot; for FCARM
      output:
        - project/Web.c  # Output file for FCARM
</code></pre>
<h2 id="generator-integration">Generator Integration</h2>
<p>The diagram below shows how a generator is integrated into the CMSIS build process. The data flow is exemplified on STM32CubeMX (Generator ID for this example is <code>CubeMX</code>). The information about the project is delivered to the generator using the <a href="../YML-CBuild-Format/#generator-information-files">Generator Information</a> files (<code>&lt;solution-name&gt;.cbuild-gen-idx.yml</code> and <code>&lt;context&gt;.cbuild-gen.yml</code>). This information provides <code>CubeMX</code> with the project context, such as the selected board or device, and CPU mode, such as TrustZone, disabled/enabled.</p>
<p><img alt="Generator Integration" src="../images/Generator-Integration.png" title="Generator Integration" /></p>
<p>The utility <a href="https://github.com/Open-CMSIS-Pack/generator-bridge"><code>cbridge</code></a> gets as parameter the <code>&lt;solution-name&gt;.cbuild-gen-idx.yml</code> and calls the generator. For the <code>CubeMX</code> generator example, these files are created:</p>
<ul>
<li><code>*.ioc</code> CubeMX project file with current project settings</li>
<li><code>*.c/.h</code> source files, i.e. for interfacing with drivers</li>
<li><code>&lt;project-name&gt;.cgen.yml</code> (created by <code>cbridge</code>) provides the data for project import into the csolution build process.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CubeMX itself does not have the required interfaces to the csolution project format. The utility <code>cbridge</code> converts the <a href="../YML-CBuild-Format/">build information files</a> into command-line options for CubeMX. <code>cbridge</code> also generates the <code>&lt;project-name&gt;.cgen.yml</code> based on the information generated by CubeMX.</p>
</div>
<h3 id="generator-start-via-component">Generator Start via <code>component</code></h3>
<p>A <a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/pdsc_components_pg.html#element_component"><code>&lt;component&gt;</code></a> element with a <code>generator</code> attribute in a <code>*.PDSC</code> file is used to start the generator. Typically this component is provided in a Device Family Pack (DFP) or a Board Support Pack (BSP).</p>
<p><strong>Example component for CubeMX in DFP:</strong></p>
<pre><code class="language-xml">  &lt;component generator=&quot;CubeMX&quot; Cclass=&quot;Device&quot; Cgroup=&quot;CubeMX&quot; Cversion=&quot;0.9.0&quot;&gt;
      &lt;description&gt;Configure device or board with STM32CubeMX&lt;/description&gt;
  &lt;/component&gt;
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>No <code>&lt;generator&gt;</code> element in the *.PDSC file is required when the <a href="#global-generator-registry-file">Global Generator Registry File</a> is used. The <code>generator="id"</code> attribute of the <code>&lt;component&gt;</code> element in the <code>*.PDSC</code> file is the reference to the <code>- id:</code> list node in the <code>global.generator.yml</code> file.</p>
</div>
<h3 id="global-generator-registry-file">Global Generator Registry File</h3>
<p>For generators with no <code>&lt;generator&gt;</code> element in the *.PDSC file, the <code>global.generator.yml</code> in the CMSIS-Toolbox <code>./etc</code> directory contains is used. The <code>generator:</code> node in this YAML file registers the supported generators with the following keys:</p>
<table>
<thead>
<tr>
<th style="text-align: left;"><code>generator:</code></th>
<th style="text-align: left;"></th>
<th style="text-align: left;">Content</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>- id:</code></td>
<td style="text-align: left;"><strong>Required</strong></td>
<td style="text-align: left;"><code>&lt;generator-id&gt;</code> referred in the <code>*.PDSC</code> file</td>
</tr>
<tr>
<td style="text-align: left;">&nbsp;&nbsp;&nbsp; <code>download-url:</code></td>
<td style="text-align: left;">Optional</td>
<td style="text-align: left;">URL for downloading the generator</td>
</tr>
<tr>
<td style="text-align: left;">&nbsp;&nbsp;&nbsp; <code>run:</code></td>
<td style="text-align: left;"><strong>Required</strong></td>
<td style="text-align: left;">Name and location of the utility that starts the generator</td>
</tr>
<tr>
<td style="text-align: left;">&nbsp;&nbsp;&nbsp; <code>path:</code></td>
<td style="text-align: left;"><strong>Required</strong></td>
<td style="text-align: left;">Output directory of the generator. Contains the file <code>*.cgen.yml</code>.</td>
</tr>
</tbody>
</table>
<pre><code class="language-yml">generator:
  - id: CubeMX
    download-url: https://www.st.com/en/development-tools/stm32cubemx.html#st-get-software
    run: ../bin/cbridge
    path: $SolutionDir()$/STM32CubeMX/$TargetType$
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The only argument to the <code>run:</code> command is the path to the <a href="../YML-CBuild-Format/#generator-information-files">Generator Information Index File</a>. There are no configurable parameters for this utility. The invocation is:<br />
<code>cbrige &lt;csolution-name&gt;.cbuild-gen-idx.yml</code></p>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../YML-CBuild-Format/" class="btn btn-neutral float-left" title="Build Information Files"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../pack-tools/" class="btn btn-neutral float-right" title="Pack Creation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/Open-CMSIS-Pack/cmsis-toolbox" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../YML-CBuild-Format/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../pack-tools/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
