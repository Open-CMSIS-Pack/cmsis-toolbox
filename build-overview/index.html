<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>CSolution Project Structure - CMSIS-Toolbox</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "CSolution Project Structure";
        var mkdocs_page_input_path = "build-overview.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CMSIS-Toolbox
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../build-tools/">Build Tools</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">CSolution Project Structure</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview-of-operation">Overview of Operation</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#source-code-of-software-packs">Source Code of Software Packs</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#project-examples">Project Examples</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#github-repositories">GitHub repositories</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#template-projects">Template Projects</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#minimal-project-setup">Minimal Project Setup</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#context">Context</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#toolchain-agnostic-project">Toolchain Agnostic Project</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdefaultyml">cdefault.yml</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#compiler-selection">Compiler Selection</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#reproducible-builds">Reproducible builds</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#repository-contents">Repository Contents</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#project-setup-for-related-projects">Project Setup for Related Projects</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#working-with-context-set">Working with context-set</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#external-tools-and-build-order">External Tools and Build Order</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#project-dependency">Project Dependency</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#software-layers">Software Layers</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#target-production-hardware">Target Production Hardware</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#test-case-project">Test Case Project</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration-settings">Configuration Settings</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#software-layers-in-packs">Software Layers in Packs</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#directory-structure">Directory Structure</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#working-areas">Working Areas</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#project-area">Project Area</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#rte-directory-structure">RTE Directory Structure</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#output-directory-structure">Output Directory Structure</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#software-components">Software Components</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#plm-of-configuration-files">PLM of Configuration Files</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#add">Add</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#upgrade">Upgrade</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#multiple-instances-of-configuration-files">Multiple Instances of Configuration files</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#rte_componentsh">RTE_Components.h</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cmsis_device_header">CMSIS_device_header</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_rte_-preprocessor-symbol">_RTE_ Preprocessor Symbol</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#linker-script-management">Linker Script Management</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#linker-script-preprocessing">Linker Script Preprocessing</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#automatic-linker-script-generation">Automatic Linker Script generation</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#linker-script-templates">Linker Script Templates</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#generator-support">Generator Support</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#use-a-generator">Use a Generator</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configure-generator-output">Configure Generator Output</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#detailed-usage-instructions">Detailed Usage Instructions</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../YML-Input-Format/">CSolution Project Format</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CreateApplications/">Create Applications</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ReferenceApplications/">Reference Applications</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CubeMX/">Configure STM32 Devices with STM32CubeMX</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../MCUXpressoConfig/">Configure NXP Devices with MCUXpresso Config Tools</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../YML-CBuild-Format/">Build Information Files</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../build-operation/">Build Operation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../pack-tools/">Pack Creation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../Experimental-Features/">Experimental Features</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CMSIS-Toolbox</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">CSolution Project Structure</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/Open-CMSIS-Pack/cmsis-toolbox/edit/main/docs/build-overview.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="csolution-project-structure">CSolution Project Structure</h1>
<!-- markdownlint-disable MD013 -->
<!-- markdownlint-disable MD036 -->

<p>This chapter outlines the structure of <em>csolution project files</em> that contain the build information of the software application.</p>
<ul>
<li><a href="#project-examples">Project Examples</a> and project templates help to get started with the tools.</li>
<li><a href="#software-layers">Software Layers</a> provide reusable configurations  and give projects a better structure.</li>
<li><a href="#directory-structure">Directory Structure</a> describes the overall directory structure of projects.</li>
<li><a href="#linker-script-management">Linker Script Management</a> defines the  available memory and controls the linker operation.</li>
<li><a href="#generator-support">Generator Support</a> integrates configuration tools such as STM32CubeMX or MCUXpresso Config.</li>
</ul>
<h2 id="overview-of-operation">Overview of Operation</h2>
<p>The diagram below outlines the operation of the <code>csolution</code> command <code>convert</code> that processes the <em>csolution project</em> with one or more <a href="../YML-Input-Format/#context"><code>context</code></a> configurations for an application.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li><a href="#project-examples">Project Examples</a> show different project types and provide templates for user projects.</li>
<li><a href="../build-operation/#build-process-overview">Build Process Overview</a> explains the complete end-to-end build process.</li>
</ul>
</div>
<p><img alt="Operation Overview of csolution" src="../images/operation-overview.png" title="Operation Overview of csolution" /></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Input Files</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/cp_PackTutorial.html#cp_SWComponents">Generic Software Packs</a></td>
<td style="text-align: left;">Provide re-usable software components that are typically configurable  towards a user application.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/cp_PackTutorial.html#createPack_DFP">DFP Software Packs</a></td>
<td style="text-align: left;">Device-related information (including memory sizes) for the tool configuration.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/cp_PackTutorial.html#createPackBoard">BSP Software Packs</a></td>
<td style="text-align: left;">Board specific configuration (i.e. additional memory resources).</td>
</tr>
<tr>
<td style="text-align: left;"><a href="../YML-Input-Format/#cdefault">cdefault.yml</a></td>
<td style="text-align: left;">When enabled with <a href="../YML-Input-Format/#solution"><code>cdefault:</code></a>, setup of toolchain specific controls and pre-defined toolchains.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="../YML-Input-Format/#solution">*.csolution.yml</a></td>
<td style="text-align: left;">Complete scope of the application with sub-projects. Defines <a href="../YML-Input-Format/#target-types">target</a> and <a href="../YML-Input-Format/#build-types">build</a> types.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="../YML-Input-Format/#project">*.cproject.yml</a></td>
<td style="text-align: left;">Content of an independent build step (linker or library archiver run).</td>
</tr>
<tr>
<td style="text-align: left;"><a href="../YML-Input-Format/#layer">*.clayer.yml</a></td>
<td style="text-align: left;">Set of source files along with pre-configured components for reuse in different applications.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: left;">Input/Output Files</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><a href="../YML-CBuild-Format/#cbuild-packyml">*.cbuild-pack.yml</a></td>
<td style="text-align: left;">Exact list of the packs that are used by the application; enables <a href="#reproducible-builds">reproducible builds</a> as it locks the pack versions.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="../YML-CBuild-Format/#cbuild-setyml">*.cbuild-set.yml</a></td>
<td style="text-align: left;">Specifies the <a href="#working-with-context-set">context set</a> of projects, target-types, and build-types that are used to generate the application image.</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: left;">Output Files</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><a href="../YML-CBuild-Format/#cbuild-idxyml">*.cbuild-idx.yml</a></td>
<td style="text-align: left;">Index file of all <code>*.cbuild.yml</code> build descriptions; contains also overall information for the application.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="../YML-CBuild-Format/#cbuild-idxyml">*.cbuild.yml</a></td>
<td style="text-align: left;">Build description of a single <a href="../YML-Input-Format/#project-file-structure"><code>*.cproject.yml</code></a> input file for each context.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="#rte-directory-structure">Run-Time Environment (RTE)</a></td>
<td style="text-align: left;">Contains the user-configured files of a project along with the <code>RTE_Components.h</code> inventory file.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="#automatic-linker-script-generation">Linker Script Files</a></td>
<td style="text-align: left;">Header file that describes the memory resources.</td>
</tr>
</tbody>
</table>
<p>To generate the build information of an application project, the <code>csolution</code> command <code>convert</code> executes the following steps:</p>
<ol>
<li>
<p>Read Input Files (<em>csolution project</em> and <em>Software Packs</em>)</p>
</li>
<li>
<p>Process each project context (selected by a <a href="#working-with-context-set">context-set</a> or option: <code>--context</code>):</p>
<ul>
<li>Apply <a href="../YML-Input-Format/#pack"><code>pack:</code></a>, <a href="../YML-Input-Format/#device"><code>device:</code></a>, <a href="../YML-Input-Format/#board"><code>board:</code></a>, and <a href="../YML-Input-Format/#compiler"><code>compiler:</code></a> to filter the content of software packs.</li>
<li>From <a href="../YML-Input-Format/#groups"><code>groups:</code></a> add the list of user source files.</li>
<li>From <a href="../YML-Input-Format/#components"><code>components:</code></a> add the list of component source files.</li>
</ul>
</li>
<li>
<p>Generate <em>Output Files</em>:</p>
<ul>
<li>Update <a href="#plm-of-configuration-files">configuration files</a> in RTE directory (disable with option: <code>--no-update-rte</code>).</li>
<li>Print results of software component dependency validation.</li>
</ul>
</li>
</ol>
<h3 id="source-code-of-software-packs">Source Code of Software Packs</h3>
<p>Software packs and the related <a href="#software-components">components:</a> allow you to share and reuse code. The content of a software pack is, therefore, <em>read-only</em> (with the exception of <a href="#configuration-settings">configuration files</a> that are copied to the <a href="#rte-directory-structure">RTE directory</a>) as these source code files should not be modified by a user.</p>
<p>The <strong>benefit</strong> is a clean project directory that only contains the user code and <a href="#configuration-settings">configuration files</a> for <a href="#software-components">components:</a>. This keeps a <a href="#repository-contents">repository</a> small and makes it easy to upgrade to a <a href="#plm-of-configuration-files">new pack version</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>During the development of a software pack, you may <a href="../build-tools/#install-a-repository">install a repository</a>, which contains the source of the software pack.</li>
<li>You may copy the content of a software pack to your project workspace and provide a <a href="../YML-Input-Format/#pack">path to the pack</a>.</li>
</ul>
</div>
<h2 id="project-examples">Project Examples</h2>
<h3 id="github-repositories">GitHub repositories</h3>
<p>The following repositories provide several working examples:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Repository</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><a href="https://github.com/Open-CMSIS-Pack/csolution-examples">csolution-examples</a></td>
<td style="text-align: left;">Contains several getting started examples that show single-core, multi-core, and TrustZone setup as well as how to use a generator (CubeMX).</td>
</tr>
<tr>
<td style="text-align: left;"><a href="https://github.com/Arm-Examples">github.com/Arm-Examples</a></td>
<td style="text-align: left;">Contains many examples that include CMSIS-Toolbox setup.</td>
</tr>
</tbody>
</table>
<p>The section below explains the overall concepts considered by the <strong><code>csolution</code> Project Manager</strong> based on examples.</p>
<h3 id="template-projects">Template Projects</h3>
<p>The following <code>*.csolution.yml</code> templates may be used to create embedded applications.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Template</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><a href="https://github.com/Open-CMSIS-Pack/csolution-examples/tree/main/Templates/Simple">Simple</a></td>
<td style="text-align: left;">A csolution.yml template with a single <code>*.cproject.yml</code>.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="https://github.com/Open-CMSIS-Pack/csolution-examples/tree/main/Templates/Multicore">Multicore</a></td>
<td style="text-align: left;">A csolution.yml template with multiple <code>*.cproject.yml</code> files, each targeting one processor of a multicore device.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="https://github.com/Open-CMSIS-Pack/csolution-examples/tree/main/Templates/TrustZone">TrustZone</a></td>
<td style="text-align: left;">A csolution.yml template with a non-secure <code>*.cproject.yml</code> and an optional secure <code>*.cproject.yml</code> file.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="https://github.com/Open-CMSIS-Pack/csolution-examples/tree/main/Templates/UnitTest">UnitTest</a></td>
<td style="text-align: left;">A csolution.yml template that shares one HAL <code>*.clayer.yml</code> with multiple <code>*.cproject.yml</code> files for unit testing.</td>
</tr>
</tbody>
</table>
<p>To use these templates, copy the content of the folder to your own application folder. Then adapt the names accordingly and add missing information.</p>
<p>Refer to <a href="https://github.com/Open-CMSIS-Pack/csolution-examples/tree/main/Templates">CMSIS-Toolbox Templates</a> for more details.</p>
<h3 id="minimal-project-setup">Minimal Project Setup</h3>
<p>A minimal application requires two files:</p>
<ul>
<li>
<p><code>Sample.csolution.yml</code> that defines a <a href="../YML-Input-Format/#target-types">target type</a> with <a href="../YML-Input-Format/#board">board</a> or <a href="../YML-Input-Format/#device">device</a>. It includes a <a href="../YML-Input-Format/#projects">project</a> and selects a <a href="../YML-Input-Format/#compiler">compiler</a>.</p>
</li>
<li>
<p><code>Sample.cproject.yml</code> defines the files and software components that are translated into an image or library archive.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When no <a href="../YML-Input-Format/#packs"><code>packs:</code></a> are specified in <em>csolution project files</em>, the tools use the latest version of the installed packs.</p>
</div>
<p><strong>Simple Project: <code>Sample.csolution.yml</code></strong></p>
<pre><code class="language-yml">solution:
  cdefault:                                   # use default setup for toolchains
  compiler: AC6                               # select the compiler to use

  packs:                                      # explicit pack selection may be omitted
    - pack: NXP::K32L3A60_DFP@16.0.0          # specify DFP
    - pack: NXP::FRDM-K32L3A6_BSP@16.0.0 

  target-types:
    - type: FRDM-K32L3A6
      board: FRDM-K32L3A6

  build-types:                                # defines toolchain options for 'debug' and 'release'
    - type: Debug
      debug: on
      optimize: debug

    - type: Release
      debug: off
      optimize: balanced

  projects:
    - project: ./Sample.cproject.yml
</code></pre>
<p><strong>Simple Project: <code>Sample.cproject.yml</code></strong></p>
<pre><code class="language-yml">project:
  packs:
    - pack: ARM::CMSIS                        # specify additional packs

  groups:
    - group: App
      files:
        - file: ./main.c

  components:
    - component: CMSIS:CORE
    - component: Device:Startup
</code></pre>
<h3 id="context">Context</h3>
<p>A <a href="../YML-Input-Format/#context-name-conventions">context</a> is defined in the <code>*.csolution.yml</code> file by <code>projects:</code>, <code>target-types:</code>, and <code>build-types:</code>. It identifies a configuration with <code>project-name</code>, <code>build-type</code>, and <code>target-type</code> and is used on various places in the CMSIS-Toolbox.</p>
<p>The following <a href="../YML-Input-Format/#context-name-conventions">context</a> refers to the example above and selects the <code>project: Sample.cproject.yml</code> with <code>build-type: Debug</code> and <code>target-type: FRDM-K32L3A6</code>:</p>
<pre><code class="language-txt">Sample.Debug+FRDM-K32L3A6
</code></pre>
<p>The <a href="../YML-Input-Format/#context-name-conventions">context</a> allows you to refer to each possible build combination that, by default, uses a different <a href="#output-directory-structure">output directory</a>. A context may be partly specified in many places.</p>
<p>The <a href="#working-with-context-set">context-set</a> defines a combination of projects and is useful when an application is composed of <a href="#project-setup-for-related-projects">multiple related projects</a>.</p>
<h3 id="toolchain-agnostic-project">Toolchain Agnostic Project</h3>
<p>Generic <a href="../YML-Input-Format/#translation-control"><strong>Translation Control</strong></a> settings enable projects that work across the range of supported compilers (AC6, GCC, IAR, CLANG). The <a href="../YML-Input-Format/#translation-control"><strong>Translation Control</strong></a> settings are mapped to specify compiler controls by the build tools.</p>
<h4 id="cdefaultyml">cdefault.yml</h4>
<p>The <code>cdefault.yml</code> file contains a common set of compiler-specific settings that select reasonable defaults with <a href="../YML-Input-Format/#misc"><code>misc:</code></a> controls for each compiler. The <a href="../YML-Input-Format/#cdefault"><code>cdefault:</code></a> node in the <code>*.csolution.yml</code> file enables the usage of this file. The directory <a href="../installation/"><code>&lt;cmsis-toolbox-installation-dir&gt;/etc</code></a> contains a <code>cdefault.yml</code> file that is used when no local copy of the <code>cdefault.yml</code> file is provided.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended that a local copy of the <code>cdefault.yml</code> file be provided in the same directory that stores the <code>*.csolution.yml</code> file.</p>
</div>
<p><strong>Example:</strong></p>
<pre><code class="language-yml">default:

  misc:
    - for-compiler: AC6
      C-CPP:
        - -Wno-macro-redefined
        - -Wno-pragma-pack
        - -Wno-parentheses-equality
        - -Wno-license-management
      C:
        - -std=gnu11
      ASM:
        - -masm=auto
      Link:
        - --entry=Reset_Handler
        - --map
        - --info summarysizes
        - --summary_stderr
        - --diag_suppress=L6314W

    - for-compiler: GCC
      C-CPP:
        - -masm-syntax-unified
        - -fomit-frame-pointer
        - -ffunction-sections
        - -fdata-sections
      C:
        - -std=gnu11
      Link:
        - --specs=nano.specs
        - --specs=nosys.specs
        - -Wl,-Map=$elf()$.map
        - -Wl,--gc-sections
        - -Wl,--no-warn-rwx-segments   # suppress incorrect linker warning

    - for-compiler: CLANG
      C-CPP:
        - -fomit-frame-pointer
        - -ffunction-sections
        - -fdata-sections
      C:
        - -std=gnu11
      Link:
        - -lcrt0
        - -Wl,-Map=$elf()$.map
        - -Wl,--gc-sections

    - for-compiler: IAR
      C-CPP: 
        - --dlib_config DLib_Config_Full.h
      Link:
        - --map=$elf()$.map
</code></pre>
<h4 id="compiler-selection">Compiler Selection</h4>
<p>There are two ways to select a toolchain:</p>
<ul>
<li>An explicit <a href="../YML-Input-Format/#compiler"><code>compiler:</code></a> selection in the <code>*.csolution.yml</code> project file:</li>
</ul>
<pre><code class="language-yml">solution:
  cdefault:           # use the cdefault.yml file with toolchain specific controls
  compiler: AC6       # select Arm Compiler
  :
</code></pre>
<ul>
<li>The command line option <code>--toolchain</code> of the <code>cbuild</code> or <code>csolution</code> tool overwrites any <code>compiler:</code> definition in the csolution project files.</li>
</ul>
<pre><code class="language-shell">cbuild Hello.csolution.yml --toolchain GCC
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li><a href="../pack-tools/#project-examples">Toolchain agnostic example projects</a> do not contain a <a href="../YML-Input-Format/#compiler"><code>compiler:</code></a> selection in the <a href="../YML-Input-Format/#solution"><code>*.csolution.yml</code></a> project file.</li>
<li>Instead the <a href="../YML-Input-Format/#select-compiler"><code>select-compiler:</code></a> node list the compilers that this <em>csolution project</em> is tested with. The <a href="https://marketplace.visualstudio.com/items?itemName=Arm.cmsis-csolution">VS Code extension Arm CMSIS Solution</a> adds the <a href="../YML-Input-Format/#compiler"><code>compiler:</code></a> node based on the installed compiler in your environment.</li>
</ul>
</div>
<h3 id="reproducible-builds">Reproducible builds</h3>
<p>Reproducible builds are supported by the <a href="../YML-CBuild-Format/#cbuild-packyml">*.cbuild-pack.yml</a> file that is created and read by the <strong>csolution</strong> project manager. This file:</p>
<ul>
<li>Records the exact list of the pack versions used during the creation of an application.</li>
<li>Ensures that pack versions do not change during development, even when new packs are installed on the host computer, for example, to develop other applications.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>The <a href="../YML-CBuild-Format/#cbuild-packyml">*.cbuild-pack.yml</a> file should be committed to a repository to ensure reproducible builds.</li>
<li>The <code>cbuild</code> option <code>--frozen-packs</code> checks that the <a href="../YML-CBuild-Format/#cbuild-packyml">*.cbuild-pack.yml</a> file exists and reports an error if any pack is changed or not available.</li>
<li>To update a pack to a new version, delete the file <a href="../YML-CBuild-Format/#cbuild-packyml">*.cbuild-pack.yml</a> or remove the information about a specific pack in this file.</li>
</ul>
</div>
<h4 id="repository-contents">Repository Contents</h4>
<p>To support reproducible builds, the following files should be committed to a repository of a version control system.</p>
<ul>
<li>All user source code files.</li>
<li>All <em>csolution project files</em> (<code>cdefault.yml</code>, <code>*.csolution.yml</code>, <code>*.cproject.yml</code>, etc.).</li>
<li>All files in the RTE directory<ul>
<li>Ensure that there are no files with the extension <em>.update@</em> as this indicates that configuration files are not up-to-date due to updated software packs.</li>
</ul>
</li>
<li>The file <code>*.cbuild-pack.yml</code> to allow <a href="#reproducible-builds">reproducible builds</a>.
Optionally, the file <code>*.cbuild-set.yml</code> defines the application's context set that should be generated.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the file <code>*.cbuild-set.yml</code> file is missing, the <code>setup</code> command creates a <code>*.cbuild-set</code> file with a selection of the first <code>target-type</code> and the first <code>build-type</code>.</p>
</div>
<h3 id="project-setup-for-related-projects">Project Setup for Related Projects</h3>
<p>A solution is the software view of the complete system. It combines projects that can be generated independently and
therefore, manages related projects. It may also be deployed to different targets during development as described in section <a href="#software-layers">Software Layers</a>.</p>
<p>The picture below shows a system that is composed of:</p>
<ul>
<li>Project A that implements a time-critical control algorithm running on an independent processor #2.</li>
<li>Project B is a cloud-connected IoT application with Machine Learning (ML) functionality.</li>
<li>Project C is the separate data model of the ML algorithm, allowing independent updates.</li>
<li>Project D implements the device security (for example, with TF-M that runs with TrustZone in secure mode).</li>
</ul>
<p>In addition, such systems may have a boot-loader that can also be implemented as another independent project.</p>
<p><img alt="Related Projects of an Embedded System" src="../images/Solution.png" title="Related Projects of an Embedded System" /></p>
<p>At the level of the <code>*.csolution.yml</code> file, the <code>target-types:</code> and <code>build-types:</code> are managed so that a common set is available across all <code>*.cproject.yml</code> files in the system.</p>
<ul>
<li>
<p><code>target-types:</code> typically describe a different hardware target system.</p>
</li>
<li>
<p><code>build-types:</code> typically describe a build variant of the same hardware target system.</p>
</li>
</ul>
<p>Both types are used for peripherals and the same hardware configuration but may compile a different variant (i.e. with test I/O enabled) of an application.</p>
<p><strong>Related Projects: <code>iot-product.csolution.yml</code></strong></p>
<pre><code class="language-yml">solution:
   :                            # setup not shown

  target-types:
    - type: Board
      board: NUCLEO-L552ZE-Q    # uses device defined by the board

    - type: Production-HW
      device: STM32U5X          # specifies device

  build-types:
    - type: Debug
      optimize: none
      debug: on

    - type: Release
      optimize: balanced
      debug: on

    - type: Test
      optimize: size
      debug: on

  projects:
    - project: ./security/TFM.cproject.yml           # Project D: Only generated for build type: Release
      for-context: .Release
    - project: ./application/MQTT_AWS.cproject.yml   # Project B
    - project: ./mldata/Model.cproject.yml           # Project C
    - project: ./bootloader/Bootloader.cproject.yml  # Not generated for target type: Board
      not-for-context: +Board
    - project: ./processor2/Control.cproject.yml     # Project A
</code></pre>
<h3 id="working-with-context-set">Working with context-set</h3>
<p>Frequently, it is required to build applications with different <a href="#context">context</a> types. The following command line example generates the <code>iot-product.csolution.yml</code> with build type <code>Debug</code> for the project <code>MQTT_AWS.cproject.yml</code>, while the other projects use the build type <code>Release</code>. When using the option <code>-S</code> or <code>--context-set</code>, this selection is saved to the file <code>iot-product.cbuild-set.yml</code> located in the same directory as the <code>*.csolution.yml</code> file. Refer to <a href="../YML-CBuild-Format/#cbuild-setyml">File Structure of <code>*.cbuild-set.yml</code></a> for details.</p>
<pre><code class="language-txt">cbuild iot-product.csolution.yml -c TFM.Release+Board -c MQTT_AWS.Debug+Board -c Bootloader.Release+Board -S
</code></pre>
<p>The saved context-set (<code>iot-product.cbuild-set.yml</code>) is used when the option <code>-S</code> or <code>--context-set</code> is used without option <code>--context</code> or <code>-c</code>.</p>
<pre><code class="language-txt">cbuild iot-product.csolution.yml -S
</code></pre>
<p><strong>Rules for context-set</strong></p>
<ul>
<li>The same <a href="#context">target-type</a> must be selected for all projects.</li>
<li>Only one <a href="#context">build-type</a>  can be selected for a project.</li>
<li>Projects that are not required can be excluded.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a href="https://marketplace.visualstudio.com/items?itemName=Arm.cmsis-csolution">VS Code extension Arm CMSIS Solution</a> always uses a <code>context-set</code> that is selected in the Manage Solution view.</p>
</div>
<h3 id="external-tools-and-build-order">External Tools and Build Order</h3>
<p>The <a href="../YML-Input-Format/#executes"><code>executes:</code></a> node integrates <a href="../build-operation/#cmake-integration">CMake</a> scripts, projects, and external tools. The <code>input:</code> and  <code>output:</code> list typically refers to files and therefore define the build order of projects:</p>
<ul>
<li>When <code>input:</code> contains files that are the <a href="../YML-Input-Format/#output">output</a> of a <code>cproject.yml</code>, this project part is built first.</li>
<li>When <code>output:</code> contains files that are the input of a <code>cproject.yml</code>, the <code>execute:</code> node is built first.</li>
</ul>
<p><strong>Example:</strong></p>
<p>The <code>KeyGenerator</code> tool builds the file <code>keys.c</code>, which is added as a source <a href="../YML-Input-Format/#files">file:</a> for other projects. Using <code>cbuild My.csolution.yml [--context-set]</code> starts the build process of the application and runs the <code>KeyGenerator</code> before building projects that use the source file <code>keys.c</code> as input.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using <code>cbuild</code> with the option <code>--context</code> does not run <code>execute:</code> nodes as it triggers project builds only. The option <code>--context-set</code> must be used.</p>
</div>
<pre><code class="language-yml">solution:
    :
  executes:
    - execute: GenKeys                      # is a CMake target name
      run: KeyGenerator -k $input(0)$ -p $input(1)$ -o $output$
      input:
        - $SolutionDir()$/keyfile.txt       # input(0) contains key in text format
        - $SolutionDir()$/passcode.txt      # input(1) contains passcode in text format
      output:
        - $SolutionDir()$/keys.c            # output keys source file (input to other projects)
</code></pre>
<h4 id="project-dependency">Project Dependency</h4>
<p>An <a href="../YML-Input-Format/#access-sequences">access sequence</a> that refers to the output of another project also impacts the build order.</p>
<p><strong>Example:</strong></p>
<p>The <a href="../YML-Input-Format/#access-sequences">access sequence</a> <code>$cmse-lib(Project_S)$</code> includes the secure entry library of <code>Project_S</code>. Hence, <code>Project_S</code> is built before the non-secure project part of the application.</p>
<pre><code class="language-yml">project:                                 # Non-secure project
    :
  groups:
    - group: CMSE Library
      files:
        - file: $cmse-lib(Project_S)$    # Secure part of an application
</code></pre>
<h2 id="software-layers">Software Layers</h2>
<p>Software layers collect source files and software components along with configuration files for reuse in different projects. Software Layers gives projects a better structure and simplifies:</p>
<ul>
<li>Development flows with evaluation boards and production hardware.</li>
<li>Evaluation of middleware and hardware modules across different microcontroller boards.</li>
<li>Code reuse across projects, i.e. board support for test-case deployment.</li>
<li>Test-driven software development on simulation model and hardware.</li>
</ul>
<p><strong>Simple Example:</strong></p>
<p>This example uses a layer to include an RTOS kernel. The file <code>MyProject.cproject.yml</code> includes the file <code>RTOS.clayer.yml</code> using the <a href="../YML-Input-Format/#linker"><code>layers:</code></a> node:</p>
<pre><code class="language-yml">project:
  groups:
    - group: App
      files:
        - file: ./main.c

  components:
    - component: CMSIS:CORE
    - component: Device:Startup

  layers:
    - layer: ../Layer/RTOS.clayer.yml    # Add RTOS kernel
</code></pre>
<p>The <code>RTOS.clayer.yml</code> file defines the kernel along with configuration settings.</p>
<pre><code class="language-yml">layer:
  description: RTX RTOS with configuration settings

  packs:
    - pack: ARM:CMSIS-RTX

  components:
    - component: CMSIS:RTOS2:Keil RTX5&amp;Source
</code></pre>
<p>The diagram below shows two different scenarios, which are explained in the following sections.</p>
<p><img alt="Layer Usage" src="../images/Layers.png" title="Layer Usage" /></p>
<h3 id="target-production-hardware">Target Production Hardware</h3>
<p>Software development frequently starts on evaluation boards. Using a board layer simplifies re-targeting to  production hardware. The following <code>*.csolution.yml</code> file exemplifies the concept. A software developer starts with a board layer for the evaluation board in the folder <code>MyBoard</code>. Once the production hardware is available, this layer is copied to a different folder (i.e. <code>MyHardware</code>). As both layers are independently managed, the configuration of the <code>MyHardware</code> layer can be modified, for example, to target different devices, pin layout, or peripheral configurations.</p>
<p>In the <code>*.csolution.yml</code> project, the layer is defined using a <a href="../YML-Input-Format/#variables">variable</a>. By changing the <code>target-type</code> during the build process, the software developer can continue to use the evaluation board or target the production hardware.</p>
<pre><code class="language-yml">solution:
  cdefault:
  compiler: AC6

  target-types:
    - type: EvalBoard
      board: STMicroelectronics::B-U585I-IOT02A:Rev.C
      device: STMicroelectronics::STM32U585AIIx
      variables:
        - Board-Layer: $SolutionDir()$/MyBoard/Board.clayer.yml

    - type: ProductionHW
      device: STMicroelectronics::STM32U575AIIx    # uses a different device
      variables:
        - Board-Layer: $SolutionDir()$/MyHardware/Board.clayer.yml

  build-types:
    - type: Debug
      debug: on
      optimize: debug
    - type: Release
      debug: off
      optimize: balanced

  projects:
    - project: HID/HID.cproject.yml
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>The <a href="https://arm-software.github.io/MDK-Middleware/latest/General/working_with_examples.html">MDK-Middleware examples</a> are structured in this way. Start with a board layer that is provided in several <a href="https://github.com/Open-CMSIS-Pack#stm32-packs-with-generator-support">Board Support Packs</a>.</li>
<li>Another project that extends this concept to hardware shields is the <a href="https://github.com/Open-CMSIS-Pack/Sensor-SDK-Example">Sensor-SDK-Example</a>.</li>
</ul>
</div>
<h3 id="test-case-project">Test Case Project</h3>
<p>Modern software design mandates for <a href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven development</a> that utilize DevOps or CI principals. Simulation models such as the <a href="https://arm-software.github.io/AVH/main/overview/html/index.html">Arm Virtual Hardware (AVH) FVP</a> allow test automation without target hardware.</p>
<p>However, in some cases, tests should also be performed on physical hardware. A test case project may, therefore, contain targets for simulation and physical hardware. The <em>csolution project</em> format allows multiple test projects to be combined to validate different parts of the application.</p>
<pre><code class="language-yml">solution:
  cdefault:
  compiler: GCC
    :                              # pack definition not shown

  target-types:
    - type: Board
      board: NUCLEO-L552ZE-Q
      variables:
        - Board-Layer: ./Board/NUCLEO-L552ZE-Q/Board.clayer.yml

    - type: Virtual
      board: VHT-Corstone-300      # Virtual Hardware platform (appears as a board)
      variables:
        - Board-Layer: ./Board/Corstone-300/AVH.clayer.yml

  projects:
    - project: ./TestSuite1/TestCases.cproject.yml
    - project: ./TestSuite2/TestCases.cproject.yml
    - project: ./TestSuite3/TestCases.cproject.yml
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>Several <a href="https://github.com/Arm-Examples#avh-fvp-examples">examples for Arm Virtual Hardware (AVH) FVP simulation models</a> show usage of <em>csolution projects</em> in CI workflows.</li>
<li>The project <a href="https://github.com/ARM-software/AVH-MLOps/tree/main/AVH-MLOps-main">AVH-MLOps-Main</a> is a test project that shows retargeting to different processors using a layer.</li>
<li>The project <a href="https://github.com/Arm-Examples/AWS_MQTT_Demo">AWS_MQTT_Demo</a> extends this concept with retargeting of an IP communication to virtual or physical hardware.</li>
</ul>
</div>
<h3 id="configuration-settings">Configuration Settings</h3>
<p>A software layer is a set of source files and pre-configured software components or source code that can be shared across multiple projects. To achieve this, the configuration files of a <a href="../YML-Input-Format/#layer"><code>layer</code></a> are stored within the directory structure of the software layer. This separate <a href="#rte-directory-structure">RTE Directory Structure</a> allows that projects
can share a <code>layer</code> with common configuration settings.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using a generator, such as CubeMX or MCUxpresso, the output should be redirected as described under <a href="#configure-generator-output">Configure Generator Output</a>.</p>
</div>
<h3 id="software-layers-in-packs">Software Layers in Packs</h3>
<p>Software layers for <a href="../ReferenceApplications/"><em>reference applications</em></a> may be published in software packs. For more information, refer to <a href="../pack-tools/#layers">Pack Creation &raquo; Layers</a>.</p>
<h2 id="directory-structure">Directory Structure</h2>
<p>This section describes how the <code>csolution</code> based project files should be organized to allow the scenarios described above. This section also gives guidelines for a directory structure.</p>
<p>Refer to <a href="../YML-Input-Format/#directory-control">Directory Control</a> for information about configuring these directories.</p>
<h3 id="working-areas">Working Areas</h3>
<p>The table below explains the different working area sections of an application project.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Working Area</th>
<th style="text-align: center;">Access</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><a href="#project-area">Project Area</a></td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Contains user source code files managed by the user along with the  project files (see next item).</td>
</tr>
<tr>
<td style="text-align: left;"><a href="../YML-Input-Format/#project-file-structure">Project files</a></td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Created by a user or an IDE to describe the application project.</td>
</tr>
<tr>
<td style="text-align: left;">Component source code</td>
<td style="text-align: center;">RO</td>
<td style="text-align: left;">Content of software packs; the location is specified by the environment variable <a href="../installation/#environment-variables"><code>CMSIS_PACK_ROOT</code></a> or the node <a href="../YML-Input-Format/#pack"><code>pack: path</code></a> in project files.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="#rte-directory-structure">Component Configuration​</a></td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">User-editable config files of software components that are copied to the RTE directory.</td>
</tr>
<tr>
<td style="text-align: left;">Generator artifacts​</td>
<td style="text-align: center;">RO (see note)</td>
<td style="text-align: left;">Managed by domain-specific configuration tools such as STM32CubeMX or MCUXpresso.</td>
</tr>
<tr>
<td style="text-align: left;"><a href="../YML-Input-Format/#directory-control">Build artifacts</a></td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Created during the build process for example by a compiler.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some generators allow user modification of the generated files. For example, STM32CubeMX allows modification of source code between <code>/* USER CODE BEGIN */</code> and <code>/* USER CODE END */</code> and preserves this modification even when the STM32CubeMX regenerates the files.</p>
</div>
<h3 id="project-area">Project Area</h3>
<p>There are no strict rules on how to organize the project area that stores the user source code. However, the following guidelines apply:</p>
<ul>
<li>Each <a href="#project-examples">solution</a> should have a distinct base directory. This directory contains the file <code>*.csolution.yml</code> which refers to the independent projects defined with <code>*.cproject.yml</code> files.</li>
</ul>
<p>Each project should have a distinct base directory. This directory contains the file <code>*.cproject.yml</code>, which defines the project's content. The project's source code might be grouped in subdirectories that are typically stored in this base directory. The <a href="#rte-directory-structure">configuration files</a> of the software components are typically stored in a subdirectory with the name <code>./RTE</code>.</p>
<ul>
<li>A <code>*.cproject.yml</code> may refer to one or more <a href="#software-layers">software layers</a> with <code>*.clayer.yml</code> files. Each software layer should have a distinct base directory with a similar structure as a project. This base directory contains the file <code>*.clayer.yml</code> that defines the content of the software layer. It also contains the user source code (optionally organized in sub-directories) and the <a href="#rte-directory-structure">configuration​ files</a> of software components that belong to this layer, typically stored in a sub-directory with the name <code>./RTE</code>.</li>
</ul>
<h3 id="rte-directory-structure">RTE Directory Structure</h3>
<p>The table below summarizes the overall directory structure and further details the <code>./RTE</code> directory. The <code>./RTE</code> directory contains the configuration information for software components and is managed by the <strong><code>csolution</code> Project Manager</strong>. It contains:</p>
<ul>
<li>Configuration files of the software components. These files have <code>attr="config"</code> in the PDSC-file of the software packs.  Refer to <a href="#plm-of-configuration-files">PLM of Configuration Files</a> for more information.</li>
<li>The file <a href="#rte_componentsh"><code>RTE_components.h</code></a> and pre-include files are generated based on the software packs' PDSC file information.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>./RTE</code> directory structure is maintained by tools. You should not modify its structure. However, the complete directory should be committed to a repository of a version control system.</p>
</div>
<table>
<thead>
<tr>
<th style="text-align: left;">Directory Structure</th>
<th style="text-align: left;">Content</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>&lt;csolution&gt;</code></td>
<td style="text-align: left;">Base directory that contains one or more <code>*.csolution.yml</code> files.</td>
</tr>
<tr>
<td style="text-align: left;"><code>&lt;project&gt;</code></td>
<td style="text-align: left;">Each project has its own directory; this base directory contains the <code>*.cproject.yml</code> file.</td>
</tr>
<tr>
<td style="text-align: left;"><code>&lt;project&gt;/RTE/&lt;Cclass&gt;</code></td>
<td style="text-align: left;">Configurable files for each component <code>Cclass</code> have a common directory.</td>
</tr>
<tr>
<td style="text-align: left;"><code>&lt;project&gt;/RTE/&lt;Cclass&gt;/&lt;device&gt;</code></td>
<td style="text-align: left;">Configurable files for components that have a condition to a <code>device</code> are in a separate directory.</td>
</tr>
<tr>
<td style="text-align: left;"><code>&lt;project&gt;/RTE/&lt;context-dir&gt;</code></td>
<td style="text-align: left;">Directory for <code>RTE_components.h</code> and pre-include files that are generated by the <strong><code>csolution</code> Project Manager</strong>.</td>
</tr>
<tr>
<td style="text-align: left;"><code>&lt;layer&gt;</code></td>
<td style="text-align: left;">Each layer has its own base directory; this directory contains the <code>*.clayer.yml</code> file.</td>
</tr>
<tr>
<td style="text-align: left;"><code>&lt;layer&gt;/RTE/&lt;Cclass&gt;</code></td>
<td style="text-align: left;">Configurable files for each component <code>Cclass</code> have a common directory below the layer base directory.</td>
</tr>
<tr>
<td style="text-align: left;"><code>&lt;layer&gt;/RTE/&lt;Cclass&gt;/&lt;device&gt;</code></td>
<td style="text-align: left;">Configurable files for components that have a condition to a <code>device</code> are in a separate directory below the layer base directory.</td>
</tr>
</tbody>
</table>
<p>The <code>&lt;context-dir&gt;</code> has the following format: <code>_&lt;build-type&gt;_&lt;target-type&gt;</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>cbuild</code> no longer generates the <code>&lt;context-dir&gt;</code> by default. It is, therefore, required to align the naming of <code>&lt;context-dir&gt;</code> with other tools (MDK, CMSIS-Pack-Eclipse, etc.) that support the CMSIS-Pack system.</p>
</div>
<h3 id="output-directory-structure">Output Directory Structure</h3>
<p>By default, the following output directories are used. Use <a href="../build-tools/#build-a-project"><code>cbuild</code></a> to generate the content of these output directories.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Output</th>
<th style="text-align: left;">Content</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>./out/&lt;project&gt;/&lt;target&gt;/&lt;build&gt;</code></td>
<td style="text-align: left;">Contains the final binary and symbol files of a project context.</td>
</tr>
</tbody>
</table>
<h3 id="software-components">Software Components</h3>
<p><a href="../CreateApplications/#software-components">Software components</a> are re-usable library or source files that do not require modification in the user application.
Optionally, configurable source and header files are provided to allow the setting of parameters for the software component.</p>
<ul>
<li>Configurable source and header files are copied to the project using the directory structure explained above.</li>
<li>Libraries, source, and header files that are not configurable (and need no modification) are stored in the directory
  of the software component (typically part of CMSIS_Pack_ROOT) and get included directly from this location into the
  project.</li>
<li>An include path to the header files of the software component is added to the C/C++ Compiler control string.</li>
</ul>
<div class="admonition notes">
<p class="admonition-title">Notes</p>
<ul>
<li>The <code>csolution</code> command <code>convert</code> provides the option <code>--no-update-rte</code> that disables the generation of files in the <code>./RTE</code> directory and, therefore the management of configuration files and the <code>RTE_Components.h</code> file.</li>
<li>The <code>csolution</code> command <code>update-rte</code> only updates the configuration files in the <code>RTE</code> directory.</li>
<li>Using the option <code>--verbose</code> outputs additional version details.</li>
</ul>
</div>
<h3 id="plm-of-configuration-files">PLM of Configuration Files</h3>
<p>Configurable source and header files have a piece of version information that is required during Project Lifetime Management
(PLM) of a project. The version number is important when the underlying software pack changes and provides a newer
configuration file version.</p>
<p>Depending on the PLM status of the application, <code>csolution</code> performs the following operation for configuration files:</p>
<ol>
<li><strong>Add</strong> a software component for the first time.</li>
<li><strong>Upgrade</strong> (or downgrade) a software component.</li>
</ol>
<h4 id="add"><strong>Add</strong></h4>
<p>When adding a software component for the first time, the related config file is copied twice into the related <code>RTE</code>
project directory. The first copy can be modified by the user with the parameters for the user application. The
second copy is an unmodified  backup file with the format <code>&lt;configfile&gt;.&lt;ext&gt;.base@version</code>.</p>
<p><strong>Example:</strong> A configuration file <code>ConfigFile.h</code> at version <code>1.2.0</code> is copied:</p>
<pre><code class="language-c">./RTE/component_class/ConfigFile.h                  // user editable configuration file
./RTE/component_class/ConfigFile.h.base@1.2.0       // current unmodified configuration file with version
                                                    // information; used as a base for version comparison
</code></pre>
<p><code>csolution</code> shows a user notification to indicate that files have been added:</p>
<pre><code class="language-text">./RTE/component_class/ConfigFile.h -  info: component 'name' added configuration file version '1.2.0'
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The unmodified files with <code>@version</code> information should be committed to the repository of the version control system as these files are used to upgrade configuration information using merge utilities.</p>
</div>
<h4 id="upgrade"><strong>Upgrade</strong></h4>
<p>When upgrading (or downgrading) a software component, the version information of the configuration file is considered.</p>
<ul>
<li>If the version of the unmodified backup file is identical, no operation is performed.</li>
<li>If the version differs, the new configuration file is copied with the format <code>&lt;configfile&gt;.&lt;ext&gt;.update@version</code>.</li>
</ul>
<p><strong>Example:</strong> after updating the configuration file <code>ConfigFile.h</code> to version <code>1.3.0</code>, the directory contains these files:</p>
<pre><code class="language-c">./RTE/component_class/ConfigFile.h                  // user editable configuration file (based on the current version)
./RTE/component_class/ConfigFile.h.update@1.3.0     // new configuration file; used to start a 3-way merge
./RTE/component_class/ConfigFile.h.base@1.2.0       // current unmodified configuration file with version 
                                                    // information; used as a base for version comparison
</code></pre>
<p><code>csolution</code> displays a user notification to indicate that configuration files have changed:</p>
<pre><code class="language-text">./RTE/component_class/ConfigFile.h - warning: component 'name' upgrade for configuration file version '1.3.0'
                                              added, but file inactive
</code></pre>
<p><strong>User action to complete upgrade</strong></p>
<p>The user now has several options (outside of <code>csolution</code>) to merge the configuration file information. A potential way could be to use a 3-way merge utility. After merging the configuration file, the original <code>base@version</code> file should be deleted, and the new unmodified version should become the new <code>base@version</code>. The previous configuration file may be stored as a backup, as shown below.</p>
<pre><code class="language-c">./RTE/component_class/ConfigFile.h                  // new configuration file with merge configuration
./RTE/component_class/ConfigFile.h.bak              // previous configuration file stored as backup
./RTE/component_class/ConfigFile.h.base@1.3.0       // current unmodified configuration file with version 
                                                    // information; used as a base for version comparison
</code></pre>
<h4 id="multiple-instances-of-configuration-files">Multiple Instances of Configuration files</h4>
<p>The system is also capable of handling multiple instances of configuration files as explained in the CMSIS-Pack specification under <a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/pdsc_components_pg.html#Component_Instances">Component Instances</a>. In this case, the instance %placeholder% is expanded as shown below.</p>
<pre><code class="language-c">./RTE/component_class/ConfigFile_0.h
./RTE/component_class/ConfigFile_0.h.base@1.2.0
./RTE/component_class/ConfigFile_1.h
./RTE/component_class/ConfigFile_1.h.base@1.2.0
</code></pre>
<h3 id="rte_componentsh">RTE_Components.h</h3>
<p>The file <code>./RTE/RTE_Components.h</code> is created by the CMSIS Project Manager when the option <code>--update-rte</code> is used. This option is the default for the <code>csolution convert</code> command. For each selected software component, it contains <code>#define</code> statements required by the component. These statements are defined in the <code>*.PDSC</code> file for that component. The following example shows a sample content of a RTE_Components.h file:</p>
<pre><code class="language-c">/* Auto generated Run-Time-Environment Component Configuration File *** Do not modify ! *** */

#ifndef RTE_COMPONENTS_H
#define RTE_COMPONENTS_H

/* Define the Device Header File: */
#define CMSIS_device_header &quot;stm32f10x.h&quot;

#define RTE_Network_Interface_ETH_0     /* Network Interface ETH 0 */
#define RTE_Network_Socket_BSD          /* Network Socket BSD */
#define RTE_Network_Socket_TCP          /* Network Socket TCP */
#define RTE_Network_Socket_UDP          /* Network Socket UDP */

#endif /* RTE_COMPONENTS_H */
</code></pre>
<p>The <code>RTE_Components.h</code> file is typically used in other header files to control the inclusion of files related to other components of the same software pack.</p>
<pre><code class="language-c">#include &quot;RTE_Components.h&quot;
#include  CMSIS_device_header

#ifdef  RTE_Network_Interface_ETH_0     // if component Network Interface ETH 0 is included
#include &quot;Net_Config_ETH_0.h&quot;           // add the related configuration file for this component
#endif
</code></pre>
<h3 id="cmsis_device_header">CMSIS_device_header</h3>
<p>The preprocessor symbol <code>CMSIS_device_header</code> represents the <a href="https://arm-software.github.io/CMSIS_6/latest/Core/using_pg.html#using_packs">device header file</a> provided by the CMSIS-Core. It defines the registers and interrupt mapping of the device that is used. Refer to <a href="../ReferenceApplications/#header-file-structure">Reference Applications &gt; Header File Structure</a> for more information.</p>
<h3 id="_rte_-preprocessor-symbol">_RTE_ Preprocessor Symbol</h3>
<p>The preprocessor symbol <code>_RTE_</code> is added to the compiler invocation when a CMSIS build system manages the file <code>RTE_Components.h</code>. This symbol can be used as follows:</p>
<pre><code class="language-c">#ifdef _RTE_                           // Is a CMSIS build system used?
#include &quot;RTE_Components.h&quot;            // Include Run-Time-Environment symbols
#else                                  // Otherwise, use different ways to supply required symbols
#define CMSIS_device_header &quot;stm32f10x.h&quot;     
#endif
</code></pre>
<h2 id="linker-script-management">Linker Script Management</h2>
<p>A Linker Script contains a series of Linker directives that specify the available memory and how it should be used in a project. The Linker directives reflect exactly the available memory resources and memory map for the project context.</p>
<p>This section describes the Linker Script management of the <strong><code>csolution</code> Project Manager</strong>:</p>
<ol>
<li>
<p>The <a href="../YML-Input-Format/#linker"><code>linker:</code></a> node specifies an explicit Linker Script and/or memory regions header file. This overrules Linker Scripts that are part of software components or specified using the <code>file:</code> notation.</p>
</li>
<li>
<p>The <a href="../YML-Input-Format/#linker"><code>linker:</code></a> <code>auto:</code> enables the <a href="#automatic-linker-script-generation">automatic Linker Script generation</a>.</p>
</li>
<li>
<p>If no <a href="../YML-Input-Format/#linker"><code>linker:</code></a> node is used, a Linker Script file can be provided as part of software components. The extensions <code>.sct</code>, <code>.scf</code>, <code>.ld</code>, and <code>.icf</code> are recognized as Linker Script files.</p>
</li>
<li>
<p>If no Linker Script is found, the <a href="#automatic-linker-script-generation">automatic Linker Script generation</a> is used.</p>
</li>
</ol>
<h3 id="linker-script-preprocessing">Linker Script Preprocessing</h3>
<p><img alt="Linker Script File Generation" src="../images/linker-script-file.png" title="Linker Script File Generation" /></p>
<p>A standard C preprocessor is used for the Linker Script file when:</p>
<ul>
<li>the linker script file extension is <code>*.src</code>.</li>
<li>the <a href="../YML-Input-Format/#linker"><code>linker:</code></a> node contains a <code>regions:</code> header file or a <code>define:</code>.</li>
</ul>
<p>Otherwise, no preprocessor is used, and the Linker Script file is directly passed to the linker.</p>
<h3 id="automatic-linker-script-generation">Automatic Linker Script generation</h3>
<p>The automatic Linker Script generation uses a Linker Script template and generates a <code>&lt;regions&gt;.h</code> file based on information from the software packs using the:</p>
<ul>
<li><a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/pdsc_boards_pg.html#element_board_memory"><code>&lt;device&gt;</code> - <code>&lt;memory&gt;</code> element in the DFP</a></li>
<li><a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/pdsc_family_pg.html#element_memory"><code>&lt;board&gt;</code> - <code>&lt;memory&gt;</code> element in the BSP</a></li>
</ul>
<p>Both files, the Linker Script template and the <code>&lt;regions&gt;.h</code> are located in the <a href="./#rte-directory-structure">RTE directory</a> path <code>\RTE\Device\&lt;device&gt;</code>. The <code>&lt;regions&gt;.h</code> file name is extended with:</p>
<ul>
<li><code>Bname</code> when the project context uses a <a href="../YML-Input-Format/#board-name-conventions"><code>board:</code></a> specification, i.e. <code>regions_IMXRT1050-EVKB.h</code></li>
<li><code>Dname</code> when the project context only uses a <a href="../YML-Input-Format/#device-name-conventions"><code>device:</code></a> specification, i.e. <code>regions_stm32u585xx.h</code>.</li>
</ul>
<p>Both files, the Linker Script template and the <code>&lt;regions&gt;.h</code> can be modified by the user as it might be required to adjust the memory regions or give additional attributes (such as <code>noinit</code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For more information, refer to <a href="../CreateApplications/#configure-linker-scripts">Create Applications—Configure Linker Scripts</a>.</p>
</div>
<h4 id="linker-script-templates">Linker Script Templates</h4>
<p>The following compiler-specific Linker Script template files are copied to the <code>\RTE\Device\&lt;device&gt;</code> directory when no Linker Script exists. The files are located in the directory <a href="../installation/"><code>&lt;cmsis-toolbox-installation-dir&gt;/etc</code></a> of the CMSIS-Toolbox.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Linker Script Template</th>
<th style="text-align: left;">Linker control file for ...</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>ac6_linker_script.sct.src</code></td>
<td style="text-align: left;">Arm Compiler</td>
</tr>
<tr>
<td style="text-align: left;"><code>gcc_linker_script.ld.src</code></td>
<td style="text-align: left;">GCC Compiler</td>
</tr>
<tr>
<td style="text-align: left;"><code>iar_linker_script.icf.src</code></td>
<td style="text-align: left;">IAR Compiler</td>
</tr>
<tr>
<td style="text-align: left;"><code>clang_linker_script.ld.src</code></td>
<td style="text-align: left;">CLANG Compiler (LLVM)</td>
</tr>
</tbody>
</table>
<h2 id="generator-support">Generator Support</h2>
<p><em>Generators</em>, such as STM32CubeMX or MCUXpresso Config Tools, simplify the configuration for devices and boards. The CMSIS-Toolbox implements a <a href="../build-operation/#generator-integration">generic interface for generators</a>. <em>Generators</em> may be used to:</p>
<ul>
<li>Configure device and/or board settings, such as clock configuration or pinout.</li>
<li>Add and configure software drivers, for example, for UART, SPI, or I/O ports.</li>
<li>Configure parameters of an algorithm, such as DSP filter design or motor control parameters.</li>
</ul>
<p>The steps for creating a <code>*.csolution.yml</code> application with a <em>Generator</em> are:</p>
<ol>
<li>Create the <code>*.csolution.yml</code> container that refers to the projects and selects <code>device:</code> or <code>board:</code>  (by using <code>target-types:</code>)</li>
<li>Create <code>*.cproject.yml</code> files that are referred to by the <code>*.csolution.yml</code> container.</li>
<li>Add <code>components:</code> to the <code>*.cproject.yml</code> file.</li>
<li>For components that have a <code>&lt;generator-id&gt;</code>, run the related generator.</li>
</ol>
<p>The <em>Generator</em> can add files, components, and settings to a project using the <a href="../YML-CBuild-Format/#generator-import-file"><em>Generator</em> import file (<code>*.cgen.yml</code>)</a>. The format of this file is similar to a <a href="#software-layers">software layer</a>.</p>
<h3 id="use-a-generator">Use a Generator</h3>
<p>An example that uses STM32CubeMX is provided in <a href="https://github.com/Open-CMSIS-Pack/csolution-examples">github.com/Open-CMSIS-Pack/csolution-examples</a>. The <code>./CubeMX</code> example is used below.</p>
<p>To list the <em>Generator</em> configuration of a <code>*.csolution.yml</code> use:</p>
<pre><code class="language-bash">csolution CubeMX.csolution.yml list generators --verbose
CubeMX (Global Registered Generator)                 # Name of the Generator
  base-dir: STM32CubeMX/MyBoard                      # Generator output directory for contexts listed below
    cgen-file: STM32CubeMX/MyBoard/CubeMX.cgen.yml   # Generator import file for contexts listed below
      context: CubeMX.Debug+MyBoard
      context: CubeMX.Release+MyBoard
</code></pre>
<p>To run the generator (in this case CubeMX) use:</p>
<pre><code class="language-bash">csolution CubeMX.csolution.yml run --generator CubeMX
</code></pre>
<h3 id="configure-generator-output">Configure Generator Output</h3>
<p>The <em>Generator</em> output directory and the name of the <a href="../YML-CBuild-Format/#generator-import-file"><em>Generator</em> import file (<code>*.cgen.yml</code>)</a> can be configured using the node <a href="../YML-Input-Format/#generators"><code>generators:</code></a> as shown below.</p>
<pre><code class="language-yml">  generators:
    options:
    - generator: CubeMX
      path: ../STM32CubeMX
      name: MyConfig
</code></pre>
<p>A Generator output configuration is useful for:</p>
<ul>
<li>Using a <a href="#software-layers">board layer</a> that is shareable across multiple projects.</li>
<li>Using different configurations across a <code>*.csolution.yml</code> project.</li>
</ul>
<h3 id="detailed-usage-instructions">Detailed Usage Instructions</h3>
<p>These chapters explain how to manage device and board configuration in more detail:</p>
<ul>
<li><a href="../CubeMX/"><strong>Configure STM32 Devices with CubeMX</strong></a></li>
<li><a href="../MCUXpressoConfig/"><strong>Configure NXP Devices with MCUXpresso Config Tools</strong></a></li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../build-tools/" class="btn btn-neutral float-left" title="Build Tools"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../YML-Input-Format/" class="btn btn-neutral float-right" title="CSolution Project Format">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/Open-CMSIS-Pack/cmsis-toolbox" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../build-tools/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../YML-Input-Format/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
