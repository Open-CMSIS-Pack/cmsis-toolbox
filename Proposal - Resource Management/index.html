<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Proposal - Resource Management - CMSIS-Toolbox Help</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Proposal - Resource Management";
        var mkdocs_page_input_path = "Proposal - Resource Management.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CMSIS-Toolbox Help
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../build-overview/">Build Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../build-tools/">Build Tools</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../YML-Input-Format/">CMSIS Solution Project File Format</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CreateApplications/">Create Applications</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ReferenceApplications/">Reference Applications</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CubeMX/">Configure STM32 Devices with STM32CubeMX</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../MCUXpressoConfig/">Configure NXP Devices with MCUXpresso Config Tools</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../YML-CBuild-Format/">Build Information Files</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../build-operation/">Build Operation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../pack-tools/">Pack Creation</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CMSIS-Toolbox Help</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Proposal - Resource Management</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/Open-CMSIS-Pack/cmsis-toolbox/edit/master/docs/Proposal - Resource Management.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="proposal-resource-management">Proposal - Resource Management</h1>
<!-- markdownlint-disable MD009 -->
<!-- markdownlint-disable MD013 -->
<!-- markdownlint-disable MD036 -->
<!-- markdownlint-disable MD032 -->

<p>The CMSIS-Toolbox has a simple linker management that assigns all available memory resources to a project. While this is useful for simple projects, it does not provide enough flexibility for multi-processor or multi-project applications.</p>
<p>This is a proposal on how these features could be added.</p>
<h2 id="linker-script-management">Linker Script Management</h2>
<p>The current <a href="../build-overview/#linker-script-management">linker script processing</a> is suitable for single core projects and uses:</p>
<p><img alt="Linker Script File Generation" src="../images/linker-script-file.png" title="Linker Script File Generation" /></p>
<p>At project level the <a href="../YML-Input-Format/#linker"><code>linker:</code></a> node specifies the files above.</p>
<h3 id="multi-processor-or-multi-project-applications">Multi-processor or multi-project applications</h3>
<p>In a multi-processor or multi-project application the:</p>
<ul>
<li><code>target type</code> describes the target hardware. It contains memory resources from the <code>device:</code> and optionally <code>board:</code>. For many applications it is beneficial to list all resources in a single header file (that is specific to a <code>target type</code>.)</li>
<li>A project uses a subset of resources (called regions at linker level).</li>
<li>Depending on <code>build-types</code> the resources may need adjustments.</li>
</ul>
<p>A potential solution could be: </p>
<ul>
<li>
<p>Target specific <code>regions+target.h</code> file that contains all available memory regions and allows to partition these regions for each project. This file could be auto-generated based on the information available in DFP and BSP. The <code>define</code> symbols for <code>ROM0..3</code>, <code>RAM0..3</code> would be extended with a project (see example below). </p>
</li>
<li>
<p>Project specific linker scripts that include the <code>regions+target.h</code> file.  The project specific linker scripts use the extended <code>define</code> symbols described above.</p>
</li>
</ul>
<p><strong>Example:</strong></p>
<p>The following is the <code>*.csolution.yml</code> file.  It contains 4 projects: <code>Core2</code>, <code>TFM</code>, <code>MQTT_AWS</code>, and <code>Bootloader</code>.</p>
<pre><code class="language-yml">  target-types:
    type: MyTarget

  projects:
    - project: ./core2/Core2.cproject.yml            # Project that runs on a second core
    - project: ./security/TFM.cproject.yml           # Secure project 
    - project: ./application/MQTT_AWS.cproject.yml   # Non-secure project 
    - project: ./bootloader/Bootloader.cproject.yml  # Secure project (transfers control to TFM)
</code></pre>
<p><code>regions-MyTarget.h</code></p>
<pre><code class="language-c">// &lt;h&gt;ROM Configuration
// =======================
// &lt;h&gt; __ROM0=Flash
//   &lt;o&gt; Base address &lt;0x0-0xFFFFFFFF:8&gt;
//   &lt;i&gt; Defines base address of memory region.
//   &lt;i&gt; Default: 0x08000000
#define __ROM0_BASE 0x08000000
//   &lt;o&gt; Region size [bytes] &lt;0x0-0xFFFFFFFF:8&gt;
//   &lt;i&gt; Defines size of memory region.
//   &lt;i&gt; Default: 0x00200000
#define __ROM0_SIZE 0x00200000

// This are user configurable sizes
#define __ROM0_SIZE_Core2      0x10000
#define __ROM0_SIZE_TFM        0x0
#define __ROM0_SIZE_MQTT_AWS   0x20000
#define __ROM0_SIZE_BootLoader 0x40000

// This is the allocation order
#define __ROM0_BASE_Core2      __ROM0_BASE
#define __ROM0_BASE_TFM        (__ROM0_BASE_Core2+__ROM0_SIZE_Core2)
#define __ROM0_BASE_MQTT_AWS   (__ROM0_BASE_TFM+__ROM0_SIZE_TFM)
#define __ROM0_BASE_BootLoader (__ROM0_MQTT_AWS+__ROM0_MQTT_AWS)

 // similar information is generated for ROM1..ROM3 + RAM0..RAM4
 // in case that memory is only available for a core, only a fraction of the project is created
</code></pre>
<p>The linker script is extended for each project using the project name.  The copy process is similar to an %instance%, but expands %project% with the project name.</p>
<p>Generic linker script <code>ac6_linker_script.sct.src</code></p>
<pre><code class="language-txt">LR_ROM0 __ROM0_BASE_TFM __ROM0_SIZE_TFM  {

  ER_ROM0 __ROM0_BASE_TFM __ROM0_SIZE_TFM {
    *.o (RESET, +First)
    *(InRoot$$Sections)
    *(+RO +XO)
  }

#if defined (__ARM_FEATURE_CMSE) &amp;&amp; (__ARM_FEATURE_CMSE == 3U)
  ER_CMSE_VENEER AlignExpr(+0, 32) (__ROM0_SIZE_TFM - AlignExpr(ImageLength(ER_ROM0), 32)) {
    *(Veneer$$CMSE)
  }
#endif

  RW_NOINIT __RAM0_BASE_TFM UNINIT (__RAM0_SIZE_TFM - __HEAP_SIZE - __STACK_SIZE - __STACKSEAL_SIZE) {
    *.o(.bss.noinit)
    *.o(.bss.noinit.*)
  }

  RW_RAM0 AlignExpr(+0, 8) (__RAM0_SIZE_TFM - __HEAP_SIZE - __STACK_SIZE - __STACKSEAL_SIZE - AlignExpr(ImageLength(RW_NOINIT), 8)) {
    *(+RW +ZI)
  }
  :
</code></pre>
<p><code>ac6_linker_script.sct.src</code> expanded for TFM project</p>
<pre><code class="language-txt">LR_ROM0 __ROM0_BASE_TFM __ROM0_SIZE_TFM  {

  ER_ROM0 __ROM0_BASE_TFM __ROM0_SIZE_TFM {
    *.o (RESET, +First)
    *(InRoot$$Sections)
    *(+RO +XO)
  }

#if defined (__ARM_FEATURE_CMSE) &amp;&amp; (__ARM_FEATURE_CMSE == 3U)
  ER_CMSE_VENEER AlignExpr(+0, 32) (__ROM0_SIZE_TFM - AlignExpr(ImageLength(ER_ROM0), 32)) {
    *(Veneer$$CMSE)
  }
#endif

  RW_NOINIT __RAM0_BASE_TFM UNINIT (__RAM0_SIZE_TFM - __HEAP_SIZE - __STACK_SIZE - __STACKSEAL_SIZE) {
    *.o(.bss.noinit)
    *.o(.bss.noinit.*)
  }

  RW_RAM0 AlignExpr(+0, 8) (__RAM0_SIZE_TFM - __HEAP_SIZE - __STACK_SIZE - __STACKSEAL_SIZE - AlignExpr(ImageLength(RW_NOINIT), 8)) {
    *(+RW +ZI)
  }
  :
</code></pre>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/Open-CMSIS-Pack/cmsis-toolbox" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
